<template name="marketplace">
    <div class="container marketContainer">
        <h1>Marketplace <small><span class="label label-default">Phase&nbsp;1 will include filters and searching and scrollable panes</span></small></h1>
        <span class="label label-default">You can add marketplace items in your profile page.</span>
        <!-- <button type="button" id="addSampleProductsButton" class="btn btn-default" >Add sample products</button> -->
        <!-- <button type="button" id="removeSampleProductsButton" class="btn btn-default" >Remove all sample products</button> -->
        <div id="marketNotifyDiv"></div>
<!-- 
        {{#if selectedProduct}}
            <p>Selected productId: {{selectedProduct}}</p>
        {{/if}}
 -->
        <ul>
        {{#each vendorList}}
            <li>
                <p>Vendor: {{vendorName}}</p>
                <ul>
                {{#each items}}
                    {{> marketplaceItem}}
                    <div class="popoverContent hide">
                        {{> addQtyToCart}}
                    </div>
                {{/each}}
                </ul>
            </li>
        {{/each}}
        </ul>
    </div>
</template>

<template name="marketplaceItem">
    <li>
        <img class="marketplace-product-img" src="{{#if photo.src}}{{photo.src}}{{else}}{{randomPhotoSrc}}{{/if}}" alt="{{name}} product photo">
        <ul>
            {{#if currentUser}}
                <button class="popoverThis btn btn-large btn-danger" data-toggle="popover">Buy</button>
            {{else}}
                <span class="label label-default">Login to buy items.</span>
            {{/if}}
            <li>Name: {{name}}</li>
            <li>Description: {{description}}</li>
            <li>Unit Price: {{unitPrice}} {{currency}} ({{unitType}})</li>
            <li><a href="{{../vendorLink}}">Sold by: {{../vendorName}}</a></li>
        </ul>
    </li>
</template>

<template name="addQtyToCart">
  <form class="addToCartForm">
      Quantity:
      <input type="number" name="quantityNum" value="1"/>
      <!-- TODO find a better way to pass vendor details to the event handler -->
      <input type="hidden" name="vendor_key" value="{{../vendor_key}}"/>
      <input type="hidden" name="vendorUserId" value="{{../vendorUserId}}"/>
      <input type="hidden" name="vendorBusinessId" value="{{../vendorBusinessId}}"/>
      <input type="hidden" name="vendorName" value="{{../vendorName}}"/>
      <input type="hidden" name="vendorLink" value="{{../vendorLink}}"/>
      <input type="hidden" name="vendorEmail" value="{{../vendorEmail}}"/>
      {{unitType}}
      <input type="submit" class="addToCart btn btn-default" value="Add Quantity" />
  </form>
</template>
